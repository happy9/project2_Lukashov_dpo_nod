# project2_Lukashov_dpo_nod

## Управление таблицами

Модуль поддерживает команды управления таблицами. Метаданные таблиц хранятся в файле `db_meta.json`.

### Команды

- `create_table <имя_таблицы> <столбец1:тип> <столбец2:тип> ...` — создать таблицу  
  Поддерживаемые типы: `int`, `str`, `bool`.  
  Если столбец `ID` не указан пользователем, он добавляется автоматически как `ID:int`.

- `list_tables` — показать список таблиц

- `drop_table <имя_таблицы>` — удалить таблицу

- `help` — показать справку

- `exit` — выйти

### Пример

```text
$ database

***База данных***

Функции:
<command> create_table <имя_таблицы> <столбец1:тип> .. - создать таблицу
<command> list_tables - показать список всех таблиц
<command> drop_table <имя_таблицы> - удалить таблицу

Общие команды:
<command> exit - выход из программы
<command> help - справочная информация

Введите команду: create_table users name:str age:int is_active:bool
Таблица "users" успешно создана со столбцами: ID:int, name:str, age:int, is_active:bool

Введите команду: list_tables
- users

Введите команду: drop_table users
Таблица "users" успешно удалена.

Введите команду: exit
```

## CRUD-операции

Модуль поддерживает полный набор CRUD-операций (Create, Read, Update, Delete) для работы с данными таблиц.  
Данные каждой таблицы хранятся в отдельном JSON-файле в директории `data/`.

### Команды

- `insert into <имя_таблицы> values (<значение1>, <значение2>, ...)` — добавить запись.  
  Значение `ID` **не передается**, оно генерируется автоматически.  
  Строковые значения должны быть указаны **в кавычках**.

- `select from <имя_таблицы>` — вывести все записи таблицы.

- `select from <имя_таблицы> where <столбец> = <значение>` — вывести записи по условию.

- `update <имя_таблицы> set <столбец> = <новое_значение> where <столбец> = <значение>` — обновить запись.

- `delete from <имя_таблицы> where <столбец> = <значение>` — удалить запись.

- `info <имя_таблицы>` — вывести информацию о таблице (схема и количество записей).

- `help` — вывести справку.

- `exit` — выйти из программы.

## Дополнительные возможности и безопасность

В проекте реализованы дополнительные механизмы, повышающие надёжность, удобство и качество кода.

### Обработка ошибок

Для всех операций базы данных используется централизованная обработка ошибок с помощью декоратора `handle_db_errors`.

Он перехватывает основные типы ошибок:
- `KeyError` — обращение к несуществующей таблице или столбцу
- `ValueError` — ошибки валидации входных данных
- `FileNotFoundError` — отсутствие файла данных
- другие непредвиденные ошибки

Это позволяет избежать дублирования `try...except` в коде и делает сообщения об ошибках единообразными.

### Подтверждение опасных операций

Для потенциально опасных действий используется декоратор `confirm_action`.

Перед выполнением операций удаления:
- таблицы (`drop_table`)
- записи (`delete`)

пользователю предлагается подтвердить действие:

```text
Вы уверены, что хотите выполнить "удаление записи"? [y/n]:
```
Если пользователь вводит любой ответ, кроме y, операция отменяется.

### Логирование времени выполнения

Для операций, работающих с файлами (insert, select), применяется декоратор log_time.

После выполнения команды выводится время её выполнения:

```text
Функция select выполнилась за 0.003 секунд.
```

### Кэширование результатов выборки

Для оптимизации повторных запросов select реализовано кэширование на основе замыкания.

Результаты одинаковых запросов сохраняются в памяти и повторно используются без повторного чтения файла.
При изменении данных (insert, update, delete) кэш автоматически сбрасывается.

## Демонстрация

### Запуск БД и манипуляции с таблицами
[![asciinema](https://asciinema.org/a/f1YwNIUeE8R6RX7M.svg)](https://asciinema.org/a/f1YwNIUeE8R6RX7M)

### Операции с данными в таблице
[![asciinema](https://asciinema.org/a/jwsdPtZ9YUj55MxO.svg)](https://asciinema.org/a/jwsdPtZ9YUj55MxO)

### Работа с декораторами
[![asciinema](https://asciinema.org/a/voBi1DAmBrla1cGu.svg)](https://asciinema.org/a/voBi1DAmBrla1cGu)
